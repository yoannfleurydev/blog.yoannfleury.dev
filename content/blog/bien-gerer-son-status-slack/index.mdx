---
title: Bien g√©rer son statut Slack
date: "2020-09-22T18:00:00.000Z"
published: true
ogImage: ./og_image.png
---

Il y a une fonctionnalit√© bien pratique avec Slack, c'est la possibilit√© de
mettre un statut. Bien pratique, parce qu'elle permet d'indiquer aux coll√®gues
si nous sommes en vacances, absent aujourd'hui, dans les transports, ou encore,
automatiquement, dire que nous sommes en r√©union avec l'application
[Google Calendar App](https://slack.com/app-pages/google-calendar).

Dans cet article, nous allons voir ensemble comment profiter de la force de
cette fonctionnalit√© en utilisant [le nouveau pack d'√©moji](https://slackhq.com/new-emoji-pack-to-help-with-your-remote-work-balance)
pour g√©rer la balance du t√©l√©travail, un [script bash](https://github.com/mivok/slack_status_updater/blob/master/slack_status.sh),
et quelques avantages d'[i3wm](https://i3wm.org/) pour la mise √† jour via
raccourcis clavier. Le contenu est adaptable √† n'importe quel syst√®me
d'automatisation, et l'auteur¬∑trice du script fournit √©galement un script `lua`
pour Hammerspoon et Zoom.

Voici le r√©sultat que nous souhaitons obtenir :

<figure>
  <video controls allowFullScreen>
    <source src="slack-status-update.mp4" type="video/mp4" />
  </video>
</figure>

## Cr√©ation de l'application Slack

On va utiliser [un script bash](https://github.com/mivok/slack_status_updater)
√©crit par l'utilisateur¬∑trice GitHub [mivok](https://github.com/mivok)

> Ici, je vais traduire sommairement le README du d√©p√¥t o√π se trouve le script
> bash, pour le rendre plus accessible √† ceux qui pr√©f√®rent le fran√ßais.

1. Direction la [cr√©ation d'application pour Slack](https://api.slack.com/apps/new).
2. Choisir un nom pour l'application: **Slack Status Updater**. (Il est
   int√©ressant de sp√©cifier votre nom si vous √™tes plusieurs √† faire cette
   manipulation sur un m√™me Slack)
3. Choisir le workspace Slack sur lequel installer cette application.
4. Ensuite, nous arrivons sur la page de configuration de l'application, s√©lectionner **OAuth & Permissions**

![OAuth](oauth.png)

5. Descendre dans la partie **Scopes** et **User Token Scopes** et cliquer sur **Add an OAuth Scope**.

![Ajout du scope](add-scope.png)

6. √âcrire `users.profile:write` et cliquer sur l'√©l√©ment du menu qui se pr√©sente
7. Retourner en haut de la page et cliquer sur **Install App to Workspace**.
8. Un nouvel √©cran apparait, cliquer sur **Allow**
9. On est ensuite redirig√© vers un √©cran contenant un jeton d'acc√®s commen√ßant
   par `xoxp-`. On clique sur `Copy` pour le r√©cup√©rer dans le presse-papier.

## Configuration

Une fois cette application cr√©√©e, on lance la commande `slack_status.sh setup`
et on suit les instructions afin de cr√©er le fichier de configuration qui
devrait ressembler √† quelque chose comme suit:

```bash
# Configuration file for slack_status
TOKEN=<YOUR_TOKEN>

PRESET_EMOJI_test=":white_check_mark:"
PRESET_TEXT_test="Testing status updater"

PRESET_EMOJI_zoom=":zoom:"
PRESET_TEXT_zoom="In a zoom meeting"
```

On peut ensuite le modifier de fa√ßon √† avoir quelque chose qui nous correspond
un peu plus:

```bash
TOKEN=<YOUR_TOKEN>

PRESET_EMOJI_zoom=":virtual-meeting:"
PRESET_TEXT_zoom="In a Virtual Meeting"

PRESET_EMOJI_brb=":brb:"
PRESET_TEXT_brb="Probably making coffee"

PRESET_EMOJI_here=":here:"
PRESET_TEXT_here="Available"

PRESET_EMOJI_away=":away:"
PRESET_TEXT_away="Not Available"
```

# Raccourcis avec i3wm

Maintenant que nous avons nos pr√©r√©glages, nous pouvons automatiser la mise √†
jour de notre statut Slack via des raccourcis sur i3wm. Dans un premier temps,
on va mettre notre statut √† `here` quand on se connecter √† notre session (c'est
√† dire au chargement d'i3wm).

```
# Script to change Saagie's Slack Status
exec --no-startup-id "$HOME_BIN/slack_status.sh here"
```

Ensuite, on va cr√©er un mode sp√©cial ayant pour raccourci `MOD+Shift+s` avec `s`
pour statut. Ce mode va avoir 4 options de mise √† jour de status et 2 options
pour ne rien faire:

- `h` pour `here` (pr√©sent)
- `a` pour `away` (absent)
- `b` pour `brb` (`be right back` reviens tout de suite)
- `z` pour `zoom` (pour la visio-conf√©rence)
- `Return` et `Escape` pour ne rien faire et retourner en mode `default` d'i3wm.

```txt
# ----------------------------------
# EXTERNAL INTEGRATION
# ----------------------------------
set $slack_status_changer (h)ere, (a)way, (b)rb, (z)oom
mode "$slack_status_changer" {
    bindsym z exec --no-startup-id $HOME_BIN/slack_status.sh zoom; \
      mode "default"
    bindsym a exec --no-startup-id $HOME_BIN/slack_status.sh away; \
      mode "default"
    bindsym b exec --no-startup-id $HOME_BIN/slack_status.sh brb; \
      mode "default"
    bindsym h exec --no-startup-id $HOME_BIN/slack_status.sh here; \
      mode "default"
    # back to normal: Enter or Escape
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+Shift+s mode "$slack_status_changer"
```

Et voil√†, on peut maintenant faire `Mod+Shift+s` suivi de `b` pour faire
comprendre aux coll√®gues que l'on est parti prendre un caf√©. Puis une fois
revenu, `Mod+Shift+s` suivi de `h` pour indiquer que l'on est bien pr√©sent.

Dans le m√™me esprit et toujours dans l'automatisation, je me suis mis une ligne
dans la configuration pour me mettre en `away` quand j'√©teins ma machine le soir.

Voil√†, j'esp√®re que cet article va √™tre utile. Je reste disponible sur [Twitter](https://www.twitter.com/yoannfleurydev)
pour toutes questions ou point bloquant sur cette automatisation, et sur ce,
bon dev. üëã
